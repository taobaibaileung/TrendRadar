# TrendRadar 改造方案 (修订版)

## 1. 概述

本文档根据您的最新反馈，对初版改造方案进行了修订。我们充分考虑了您对易用性、独立性、性能和内容相关性的关切，旨在提供一个更贴近您实际使用场景的方案。新方案的核心是：**保留并深度增强现有的 Obsidian 插件模式**，放弃独立 Web 应用，同时将复杂的配置过程界面化，并引入智能内容过滤机制。

## 2. 修订核心原则

*   **用户友好**: 所有核心配置，尤其是数据源管理，都将通过 Obsidian 内部的图形化界面完成，无需直接编辑 YAML 文件。
*   **轻量高效**: 坚持使用文件型数据库 (SQLite)，确保项目易于部署和迁移，不对用户造成额外的环境依赖。后端作为独立进程运行，确保不拖慢 Obsidian 主程序的响应速度。
*   **高度集成**: 所有功能都将无缝集成在 Obsidian 插件中，提供一个统一、连贯的操作体验。
*   **内容精准**: 引入多层内容过滤机制，确保呈现给您的信息是您真正关心的，自动排除娱乐八卦等无关内容。

## 3. 现状分析 (与初版一致)

项目的现有基础良好，采用“后端数据引擎 (Python/FastAPI) + 前端插件 (TypeScript/Svelte)”的架构，使用 SQLite 进行数据存储。这一架构非常适合进行本次的深度改造。

## 4. 详细设计方案 (修订版)

### 4.1. 统一架构：增强的 Obsidian 插件 + 独立后端

我们将完全聚焦于 **Obsidian 插件** 作为唯一的前端交互界面。后端 Python 程序将继续作为独立进程在后台运行，负责所有的数据抓取、分析和存储等重型任务。这种分离式架构的优势在于：

> **性能保障**：插件本身只负责向本地后端发送轻量的 API 请求和渲染数据，几乎不会占用 Obsidian 的主线程资源，从而避免了任何可能导致 Obsidian 卡顿或响应变慢的风险。

### 4.2. 数据源模块：配置全面界面化

**目标**: 实现一个无需编写代码的图形化数据源管理界面。

**设计方案**:

1.  **增强 Obsidian 设置页面**: 我们将极大地扩展插件的设置选项卡，将其打造为一个功能完善的“数据源管理中心”。用户可以在这里：
    *   **查看**: 以列表形式清晰地看到所有已配置的数据源及其类型、URL、更新频率等状态。
    *   **添加**: 点击“添加数据源”按钮，弹出一个表单，用户可以选择数据源类型（RSS, 网站, X账号），并填写相应的字段（如 URL、CSS选择器、用户名）。
    *   **编辑/删除**: 对已有数据源进行修改或删除。

2.  **新的后端 API**: 为了支持上述界面，后端需要新增几个 API 端点：
    *   `GET /api/sources`: 获取所有数据源的配置列表。
    *   `POST /api/sources`: 新增一个数据源配置。
    *   `PUT /api/sources/{source_id}`: 更新一个指定的数据源配置。
    *   `DELETE /api/sources/{source_id}`: 删除一个数据源。

3.  **动态配置加载**: 后端服务启动时，会通过 API 从配置文件（`config.yaml` 或一个专门的 `sources.json` 文件）加载数据源。当用户通过 Obsidian 插件界面修改配置时，插件会调用上述 API，后端将更新保存该配置文件，并动态地调整其内部的调度任务，无需重启服务。

### 4.3. 智能内容处理与过滤

**目标**: 确保信息流的精准性，自动过滤掉用户不感兴趣的内容。

**设计方案**:

1.  **AI 初步筛选**: 在 AI 分析的 Prompt 中加入明确的“内容过滤器”指令。这是最高效的第一道防线。

    > **示例 Prompt 指令**:
    > "请首先判断本文是否属于财经、科技、商业、国际关系或地缘政治范畴。如果文章内容主要为娱乐、体育、社会八卦或名人轶事，请直接在返回的 JSON 中将 `category` 字段设为 `irrelevant`，其他字段可为空。否则，请继续进行详细分析。"

    后端在收到 AI 的分析结果后，会检查 `category` 字段。如果为 `irrelevant`，则直接丢弃该文章，不进行后续处理和存储。

2.  **关键词黑名单**: 在插件的设置界面中，增加一个“关键词黑名单”输入框。用户可以输入不希望看到的关键词（如“娱乐”、“八卦”、“明星”等）。后端在进行 AI 分析之前或之后，会检查文章标题或摘要是否包含黑名单中的任何关键词，如果包含则直接过滤掉。

### 4.4. 前端展示与交互优化

**目标**: 在 Obsidian 插件内部，实现用户需求中描述的完整交互体验。

**设计方案**:

我们将利用 Svelte 组件，对现有的 `obsidian-plugin/view.ts` 和相关 `.svelte` 文件进行重构和增强。

1.  **主视图 (ThemeList.svelte)**: 
    *   **卡片渲染**: 将 AI 分析后的主题渲染为信息卡片，包含标题、摘要、分类、标签和状态（未读/已读）。
    *   **批次归类**: 卡片将按抓取批次（可按日期或特定时间段）进行视觉上的分组，并提供折叠功能。
    *   **交互按钮**: 每张卡片上都会有“标记为已读”、“归档”和“删除”的快捷按钮。

2.  **详情视图 (ThemeDetailModal.ts / ThemeDetail.svelte)**: 
    *   点击卡片后，弹出一个丰富的模态框（Modal）。
    *   模态框顶部是 AI 生成的聚合分析内容（摘要、要点、影响度等）。
    *   模态框下部是构成该主题的原始文章列表，每篇文章都清晰地标明其**来源**（例如 “来自 RSS - 科技博客”），并提供指向原始网页的**链接**。

3.  **状态管理**: 
    *   用户的交互（点击、标记、删除）会立即调用后端 API 更新数据状态。
    *   主视图会根据数据的最新状态（如 `status` 字段）自动刷新，例如“已读”的卡片会变为灰色。 

## 5. 修订后实施计划

1.  **第一阶段：后端核心改造**
    *   实现配置管理的 API (`/api/sources`)。
    *   增强 AI 分析模块，加入内容分类过滤和关键词黑名单逻辑。
    *   扩展数据库 Schema 以支持 `status` 等新字段。

2.  **第二阶段：Obsidian 插件UI大改版**
    *   重构插件设置页面，实现数据源的图形化增删改查。
    *   实现关键词黑名单的配置界面。

3.  **第三阶段：信息流交互实现**
    *   重构主视图，实现卡片按批次展示、状态标记和交互按钮。
    *   重构详情模态框，展示完整的分析内容和可追溯的来源列表。

4.  **第四阶段：联调、测试与文档更新**
    *   进行端到端的完整功能测试，特别关注配置修改后的动态调度是否生效。
    *   优化性能，确保插件流畅运行。
    *   更新 `README.md`，提供全新的、基于图形化界面的使用指南。

这份修订后的方案更加聚焦和务实，完全围绕 Obsidian 生态系统构建，并把用户体验和易用性放在了首位。我们相信这能更好地实现您的目标。
